os: linux
group: edge

addons:
    apt:
        packages:
          - libdbus-1-dev
          - libudev-dev
          - libdbus-glib-1-dev

language: rust

matrix:
    allow_failures:
        - rust: stable
          env: TASK=fmt-travis
    include:
        - rust: stable
          env: TASK=fmt-travis
        - rust: stable
          env: TASK=build
        - rust: stable
          env: TASK=docs-travis
        - rust: stable
          env: TASK=test
        - rust: stable
          env: TASK=test-travis
          sudo: required
        - rust: nightly
          env: TASK=clippy
        - language: python
          python: "3.4"
          install: pip3 install -r tests/client-dbus/requirements.txt
          before_script:
              - cd tests/client-dbus
          env: TASK=lint
        - language: python
          python: "3.4"
          install: pip3 install -r tests/client-dbus/requirements.txt
          before_script:
              - cd tests/client-dbus
          env: TASK=fmt-travis

branches:
    only: master

script: make -f Makefile $TASK
